#include "api.h"
#include "lib.h"

inline unsigned int rol(unsigned int a, unsigned int shift) {
    unsigned int res = 0;

    asm("rol %0, %1, %2" : "=r"(res) : "r"(a), "r"(shift));

    return res;
}

inline unsigned int ror(unsigned int a, unsigned int shift) {
    unsigned int res = 0;

    asm("ror %0, %1, %2" : "=r"(res) : "r"(a), "r"(shift));

    return res;
}

#define RORI(a, shift)                                      \
    ({                                                      \
        unsigned int res = 0;                               \
                                                            \
        asm("rori %0, %1, " shift : "=r"(res) : "r"(a));    \
        res;                                                \
    })

int main() {

    int error = 0;

    error += rol(0b00000000'00000000'00000000'00000001,  1) != 0b00000000'00000000'00000000'00000010;
    error += rol(0b10000000'00000000'00000000'00000000,  1) != 0b00000000'00000000'00000000'00000001;
    error += rol(0b00000000'00000000'00000000'00001001,  4) != 0b00000000'00000000'00000000'10010000;
    error += rol(0b11110000'11110000'11110000'11110000,  8) != 0b11110000'11110000'11110000'11110000;
    error += rol(0b00000000'00000000'00000000'00000011, 31) != 0b10000000'00000000'00000000'00000001;

    error += rol(0b00000000'00000000'00000000'10101010,  3) != 0b00000000'00000000'00000101'01010000;
    error += rol(0b11100000'00000000'00000000'00000011,  5) != 0b00000000'00000000'00000000'01111100;
    error += rol(0b01010101'11110000'00000000'00000000,  7) != 0b11111000'00000000'00000000'00101010;
    error += rol(0b10000000'00000000'00000000'00011000, 11) != 0b00000000'00000000'11000100'00000000;
    error += rol(0b00001111'11110000'00000000'00000000, 13) != 0b00000000'00000000'00000001'11111110;

    error += ror(0b00000000'00000000'00000000'00000100,  1) != 0b00000000'00000000'00000000'00000010;
    error += ror(0b00000000'00000000'00000000'00000001,  1) != 0b10000000'00000000'00000000'00000000;
    error += ror(0b10010000'00000000'00000000'00000000,  4) != 0b00001001'00000000'00000000'00000000;
    error += ror(0b11111111'00000000'11111111'00000000,  8) != 0b00000000'11111111'00000000'11111111;
    error += ror(0b00000000'00000000'00000000'00001010, 32) != 0b00000000'00000000'00000000'00001010;

    error += ror(0b00000000'00000000'00000000'10101010,  3) != 0b01000000'00000000'00000000'00010101;
    error += ror(0b11100000'00000000'00000000'00000011,  5) != 0b00011111'00000000'00000000'00000000;
    error += ror(0b01010101'11110000'00000000'00000000,  7) != 0b00000000'10101011'11100000'00000000;
    error += ror(0b10000000'00000000'00000000'00011000, 11) != 0b00000011'00010000'00000000'00000000;
    error += ror(0b00001111'11110000'00000000'00000000, 13) != 0b00000000'00000000'01111111'10000000;

    error += RORI(0b00000000'00000000'00000000'00000100,  "1") != 0b00000000'00000000'00000000'00000010;
    error += RORI(0b00000000'00000000'00000000'00000001,  "1") != 0b10000000'00000000'00000000'00000000;
    error += RORI(0b10010000'00000000'00000000'00000000,  "4") != 0b00001001'00000000'00000000'00000000;
    error += RORI(0b11111111'00000000'11111111'00000000,  "8") != 0b00000000'11111111'00000000'11111111;
    error += RORI(0b00000000'00000000'00000000'00001010, "31") != 0b00000000'00000000'00000000'00010100;

    error += RORI(0b00000000'00000000'00000000'10101010,  "3") != 0b01000000'00000000'00000000'00010101;
    error += RORI(0b11100000'00000000'00000000'00000011,  "5") != 0b00011111'00000000'00000000'00000000;
    error += RORI(0b01010101'11110000'00000000'00000000,  "7") != 0b00000000'10101011'11100000'00000000;
    error += RORI(0b10000000'00000000'00000000'00011000, "11") != 0b00000011'00010000'00000000'00000000;
    error += RORI(0b00001111'11110000'00000000'00000000, "13") != 0b00000000'00000000'01111111'10000000;

    return error;
}
