#include "api.h"
#include "lib.h"

void vectorFmadd(float* a, float* b, float* c, float* d);

inline float fabs(float a) {
    return (a < 0.0f) ? -a : a;
}

inline bool isFloatEqual(float a, float b) {
    return fabs(a - b) < 1e-5f;
}

float a[] = {
    844.42200f, 258.91748f, 511.27621f, 404.93475f,
    783.79800f, 303.31235f, 476.59760f, 583.38200f,
    908.11353f, 504.68707f, 281.83755f, 755.80457f,
    618.36800f, 250.50653f, 909.74695f, 982.78580f,
    810.21710f, 902.16520f, 310.14716f, 729.83140f,
    898.83900f, 683.98334f, 472.14206f, 100.58210f,
    434.17108f, 610.88666f, 913.01105f, 966.60600f,
    477.00970f, 865.30975f, 260.49200f, 805.81946f
};

float b[] = {
    757.95465f, 404.93475f, 783.79800f, 303.31235f,
    476.59760f, 583.38200f, 908.11353f, 504.68707f,
    281.83755f, 755.80457f, 618.36800f, 250.50653f,
    909.74695f, 982.78580f, 810.21710f, 902.16520f,
    310.14716f, 729.83140f, 898.83900f, 683.98334f,
    472.14206f, 100.58210f, 434.17108f, 610.88666f,
    913.01105f, 966.60600f, 477.00970f, 865.30975f,
    260.49200f, 805.81946f, 783.79800f, 757.95465f
};

float c[] = {
    420.57217f, 132.78302f, 40.05764f, 583.38202f,
    504.68707f, 281.83755f, 755.80457f, 618.36804f,
    250.50653f, 909.74695f, 982.78583f, 810.21710f,
    902.16522f, 310.14716f, 729.83142f, 898.83905f,
    683.98334f, 472.14206f, 100.58210f, 434.17108f,
    610.88666f, 913.01105f, 966.60602f, 477.00970f,
    865.30975f, 260.49200f, 805.81946f, 420.57217f,
    132.78302f, 40.05764f, 583.38202f, 504.68707f
};

float r[] = {
    640454.125000f, 104977.468750f, 400777.312500f, 123405.093750f,
    374060.906250f, 177228.812500f, 433560.531250f, 295043.750000f,
    256191.000000f, 382354.531250f, 175262.093750f, 190144.203125f,
    563460.562500f, 246504.406250f, 737822.375000f, 887534.000000f,
    251970.515625f, 658900.625000f, 278872.937500f, 499626.687500f,
    424990.562500f, 69709.484375f, 205957.031250f, 61921.269531f,
    397268.312500f, 590747.250000f, 436320.937500f, 836834.187500f,
    124389.992188f, 697323.500000f, 204756.484375f, 611279.312500f
};

const size_t SIZE = sizeof(r) / sizeof(r[0]);

int main() {
    float result[SIZE] = {};
    vectorFmadd(a, b, c, result);

    int errors = 0;
    for (size_t i = 0; i < SIZE; i++) {
        errors += !isFloatEqual(r[i], result[i]);
    }

    return errors;
}

void vectorFmadd(float* a, float* b, float* c, float* d) {
    for (size_t i = 0; i < SIZE; i++)
        d[i] = a[i] * b[i] + c[i];
}

